<HTML>
<head><title>The Structure of a <TT>.COM</TT> File</title></head>

<BODY BGCOLOR=#FFFFFF>
<A NAME="topic10"></A><CENTER>
<A HREF="asmtut_contents.html">Contents</A> <A HREF="asmtut10.html#topic9">Up</A> <A HREF="asmtut10.html#topic9">&lt;&lt;</A> <A HREF="asmtut12.html#topic11">&gt;&gt;</A> </CENTER><HR>

<H3>The Structure of a <TT>.COM</TT> File</H3>

A <TT>.COM</TT> file consists entirely of executable code and data.
When the file <TT>Hello.COM</TT> is executed, for example (by typing
either <TT>Hello</TT> or <TT>Hello.COM</TT> at the DOS prompt), the contents
of the file are simply loaded into memory.  When the file has been
loaded, execution starts with the first byte.  All of the segment
registers are set to point to a single 64K segment starting 256 bytes
before the address where the program was loaded, so in fact execution
starts at <TT>CS:0100</TT>.  The first 256 bytes of the segment comprise
the Program Segment Prefix (PSP), which contains a variety of pieces of
information about the executing program, mostly obsolete (holdovers from
the days when MS-DOS was first designed as a clone of the old CP/M
operating system, which was developed in the mid-70's to run on the
original Intel 8080).<P>
The most useful field in the PSP is the tail of the command line; for
example, if <TT>Hello.COM</TT> had been executed by typing
<TT>Hello/full C:\Temp</TT>, then the string <TT>/full C:\Temp</TT> would be
stored in the PSP.  The program can access this argument string starting
at offset <TT>80h</TT>; the first byte gives the length of the tail (13 in
the example), and that many bytes starting at <TT>81h</TT> contain the
string itself.  The string is terminated with a carriage return
character (ASCII code <TT>0Dh</TT>), which is not included in the count.<P>
Since all of the segment registers point to the same segment, the
structure of a typical <TT>.COM</TT> program in memory is as follows:
<CENTER>
<TABLE BORDER>

<TR>
<TD ALIGN=CENTER>PSP</TD>
</TR>

<TR>
<TD ALIGN=CENTER>Program Text</TD>
</TR>

<TR>
<TD ALIGN=CENTER>Initialized Data</TD>
</TR>

<TR>
<TD ALIGN=CENTER>Uninitialized Data</TD>
</TR>

<TR>
<TD ALIGN=CENTER>Free Space</TD>
</TR>

<TR>
<TD ALIGN=CENTER>Stack</TD>
</TR>

</TABLE>

</CENTER>
The program text and initialized data are the bytes that are read in
from the <TT>.COM</TT> file, corresponding to the <TT>.text</TT> and
<TT>.data</TT> sections of the NASM source.  The PSP is generated by the
operating system, and the stack is automatically arranged to grow down
from the top of the segment.  The uninitialized data, corresponding to
the bytes reserved in the <TT>.bss</TT> section, are carved out of the
free space between the loaded bytes and the growing stack; since they
were not explicitly initialized before execution, they will start out
containing whatever garbage was left in those locations of physical
memory by the previous programs.<P>

</BODY></HTML>
